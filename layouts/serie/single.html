{{ define "main" }}

<section id="single">
    {{ partial "image.html" . }}

    <div class="content">
        <h1 class="title">{{ .Title | markdownify }}</h1>
        {{ partial "date.html" . }}
        
        <div class="article">{{ .Content }}</div>
    
    {{ if $.Param "tmdb" }}
        {{ $id := $.Param "tmdb" }}
        {{ $tmdb := getenv "HUGO_TMDB" }}
        {{ $metadata := getJSON "https://api.themoviedb.org/3/tv/" $id "?api_key=" $tmdb "&language=fr-FR" }}
        {{ $cast := getJSON "https://api.themoviedb.org/3/tv/" $id "/aggregate_credits?api_key=" $tmdb "&language=fr-FR" }}
        {{ $countries := .Site.Data.countries }}

    <div class="meta">
        <p><a href=" {{ $metadata.homepage }}">Regarder la série</a></p>
        <h3>Metadonnées</h3>
        
        <p><strong>Titre original</strong> : <em>{{ $metadata.original_name }}</em></p>

        {{ range $metadata.origin_country }}
            {{ $code := (lower . | string) }}
            {{ range where $countries ".alpha2" $code }}
                <p><strong>Nationalité</strong> : {{ .name }}</p>
            {{ end }}
        {{ end }}

        <p><strong>Année</strong> : {{ time.Format "2006" $metadata.first_air_date }}</p> 

        <ul>
            <li><strong>Genres :</strong></li>
        {{ range $metadata.genres }}
            <li>{{.name}}</li>
        {{ end }}
        </ul>

        <ul>
            <li><strong>Créateurs </strong> : </li>
            {{ range $metadata.networks }}
                <li><a href="https://www.themoviedb.org/network/{{ string .id  }}">{{ .name }}</a></li>
            {{ end }}
            {{ range $metadata.created_by }}
                <li><a href="https://www.themoviedb.org/person/{{ string .id  }}">{{ .name }}</a></li>
            {{ end }}
        </ul>

        <ul>
            <li><strong>Acteurs</strong> :</li>
            {{ range first 10 $cast.cast }}
                <li><a href="https://www.themoviedb.org/person/{{ string .id  }}">{{ .name }}</a></li>
            {{ end }}
        </ul>
    </div>
    {{ end }}

    </div>
</section>

{{ end }}
